% В этом файле следует писать текст работы, разбивая его на
% разделы (section), подразделы (subsection) и, если нужно,
% главы (chapter).

\section{Введение}

Направлением исследования для магистерской диссертации было выбрано развитие темы графов с нестандартной достижимостью, описанной в \cite{Mono}. В начале была рассмотрена сама теория и несколько частных задач с условиями на нестандартную достижимость в графах, далее они были проанализированы подробнее. Часть из них была сведена к задачам, уже описанным в \cite{Mono}, но также был выделен новый тип условий, не имеющий аналога среди рассмотренных прежде задач.

Упомянутый тип условий был описан как глобальные условия на графах с нестандартной достижимостью, также были выделены отличия, не позволяющие свести глобальные условия к каким-либо уже рассмотренным в \cite{Mono}. 

В качестве примера задачи с глобальным условием на достижимость подробно рассматривается задача с проверкой кратности количества дуг данного множества в пройденном пути. Для нее записывается формальная постановка задачи, приводится алгоритм построения вспомогательного графа и доказывается теорема о связи путей на исходном и вспомогательном графах. Таким образом показывается, что глобальные условия на достижимость являются частным случаем графов с нестандартной достижимостью. 

После этого разбирается моделирование случайного процесса на графе, в котором действует предложенное глобальное условие. Демонстрируются различные подходы к получению состояния системы в предельном случае, в том числе использующие теорию графов с нестандартной достижимостью. Похожие задачи со случайными процессами, но иными условиями на достижимость исследовались в \cite{J}.

Далее введём ряд стандартных определений теории графов, которыми будем пользоваться в данной работе. 

\begin{definition}
	Ориентированным графом, или орграфом, будем называть тройку $G(X,U,f)$, в которой:
	\begin{itemize}
		\item $X$ --- непустое множество вершин графа.
		\item $U$ --- множество дуг графа, возможно, пустое.
		\item $f:U\to X \times X$ --- отображение инцидентности, причём $f(u) = (x, y)$, где $u \in U$, $x, y \in X$, $x$ --- начальная вершина дуги $u$, а $y$ --- конечная.
	\end{itemize}
\end{definition}

\begin{definition}
	Рассмотрим пару отображений $p_1:X \times X\to X$, $p_2:X \times X\to X$:
	\begin{itemize}
		\item $p_1(x, y) = x$, $x = (p_1 \circ f)(u)$ --- начальная вершина дуги $u$,
		\item $p_2(x, y) = y$, $y = (p_2 \circ f)(u)$ --- концевая вершина дуги $u$.
	\end{itemize}
\end{definition}

\begin{definition}
	Отображение $\mu:\{1, 2, ... , n\} \to U$ такое, что 
	$(p_2 \circ f \circ \mu)(i) = (p_1 \circ f \circ \mu)(i + 1)$ при $i \in \{1, 2, ... , n-1\}$
	будем называть путём на графе $G$ длины $n$.
\end{definition}

\begin{definition}
	Для произвольного пути $\mu:\{1, 2, ... , n\} \to U$ будем обозначать:
	\begin{itemize}
		\item начальную вершину пути $(p_1 \circ f)(\mu(1))$ как $\mu_{from}$,
		\item концевую вершину пути $(p_2 \circ f)(\mu(n))$ как $\mu_{to}$.
	\end{itemize}
\end{definition}

\begin{definition}
	Для пути $\mu:\{1, 2, ... , n\} \to U$ для простоты будем писать $\mu(-1) = \mu(n)$ в случае, когда точная длина неизвестна. 
\end{definition}

\begin{definition}
	Будем говорить, что вершина $y$ достижима (в обычном смысле) из вершины $x$, если $\exists \mu: (\mu_{from} = x) \wedge (\mu_{to} = y)$. Для краткости будем обозначать это отношение как $x \succ y$.
\end{definition}

\begin{definition}
	Будем говорить, что на графе $G$ задан случайный процесс, если его вершины соответствуют состояниям, и частица может находиться только в одном из состояний в каждый момент времени. Вероятности перехода между состояниями будем задавать с помощью стохастической матрицы $P$, где $p_{ij}$ --- вероятность перехода из вершины $x_i$ в $x_j$. Такую матрицу будем называть матрицей вероятностей переходов или просто матрицей переходов.
\end{definition}

\chapter{Теоретические основы глобальных условий на достижимость на графах}

\section{Основные положения теории графов с нестандартной достижимостью}

\begin{definition}
	Графом с нестандартной достижимостью будем называть орграф $G(X,U,f)$, для которого верно:
	\begin{enumerate}
		\item Дуги разделены на множества $U_* = \{U_0, U_1, ... , U_m\}$ и $U^* = \{U^0, U^1, ... , U^k\}$, причём различные подмножества не пересекаются, a числа $k, m \in Z_+$ заранее известны.
		\item Определено отображение $\psi_\mu:N\to \overline{ [0; k] }$, называемое числовой характеристикой произвольного пути $\mu$.
		\item Задано формальное ограничение на достижимость.
	\end{enumerate}
\end{definition}

Характеристика $\psi_\mu$ определяется рекуррентно по последней дуге пути $\mu$ с помощью некоторой заданной функции, a $\psi_\mu(0) = 0$.

Можно выделить два типа формальных ограничений:
\begin{itemize}
	\item Строгие: $\forall m (\psi_\mu(m) = j) \Longrightarrow (\mu(m+1) \in U^j) $, т.е. следующая дуга пути обязана принадлежать $U^j$.
	\item Нестрогие: $\forall m (\psi_\mu(m) = j) \& ([(p_2 \circ f \circ \mu)(m)]^+ \cap U^j \neq \emptyset) \Longrightarrow (\mu(m+1) \in U^j) $, т.е. следующая дуга пути обязана принадлежать $U^j$, только если есть хотя бы одна такая дуга.
\end{itemize}

Для графов с нестандартной достижимостью в \cite{Mono} предлагается строить вспомогательные графы, причём правила построения таких графов зависят от типа налагаемых условий на достижимость. Также доказывается теорема о соответствии любого пути на вспомогательном графе допустимому пути на исходном графе. Благодаря этой теореме задачи, ставящиеся для графа с некоторым условием на достижимость, можно свести к задачам на вспомогательном графе, который, в свою очередь, является обыкновенным графом без каких-либо дополнительных условий. 

\begin{definition}
	Пусть имеем некоторый путь $\mu$ из последовательных дуг $\{u_1, u_2, ... , u_{m-1}, u_m\}$. Любой путь, полученный отбрасыванием любого количества последних дуг пути подряд вида $\{u_1, u_2, ... , u_{m-n} \}$ будем называть префиксом пути $\mu$.
\end{definition}

\begin{definition}
	Будем говорить, что допустимый путь из последовательных дуг $\{u_1, u_2, ... , u_{m-1}, u_m\}$ является модульным, если любой его префикс также является допустимым. Соответственно, это свойство будем именовать модульностью допустимого пути. 
\end{definition}

\section{Задача о допустимости пути на графах с некоторыми видами нестандартной достижимости}

Ниже приводятся рассмотренные задачи на графах, допустимость путей в которых описывается теорией о графах с нестандартной достижимостью, либо будет описана в терминах данной теории в последующих разделах. 

\subsection{Задача о проходе по дугам невозрастающей длины}

Рассмотрим ориентированный граф $G(X,U,f)$. Каждой дуге $u_i$ сопоставлено некоторое целое положительное число $l_i$, именуемое длиной данной дуги. Будем называть путь на введённом графе допустимым, если длины последовательных дуг данного пути образуют монотонную невозрастающую последовательность. Тогда, к примеру, задача о поиске кратчайшего пути (в смысле длины пути) на графе подразумевает поиск кратчайшего допустимого пути, все прочие пути не рассматриваются. 

\begin{figure}
	\centering	
	{\includegraphics[width=0.9\textwidth]{img/1.png}}
	{Пример графа с условием о проходе по дугам невозрастающей длины; двойными стрелками обозначен допустимый кратчайший путь.}
	\label{fig:pic_1}
\end{figure}

Однако, условие этой задачи можно свести к описанному в \cite{Mono} условию вентильной достижимости с возрастанием-убыванием доступа на пути. Опишем соответствие подробней. В формулировке условия вентильной достижимости с возрастанием-убыванием доступа на пути $U_*$ пусто, дуги из $U$ разбиваются на $k$ непересекающихся подмножеств множества $U^*$; это можно произвести, разделив всё множество $U$ на подмножества в соответствии с длинами $l_i$, ассоциированными с каждой дугой $u_i$. При этом $k = |\{ l_i : u_i \in U\}|$. Также нужно установить соответствие между индексами множеств $\in [1; k]$ и длинами дуг из них, сохранив при этом упорядоченность длин по возрастанию. Введём некоторое отображение $g:[1; k]\to \{ l_i : u_i \in U\}$, осуществляющее это соответствие. 

Числовой характеристикой произвольного пути (в условиях задачи называемой порядком доступа на пути) $\psi_\mu$ тогда будет являться длина последней дуги пути. Соответственно, если $\psi_\mu(i) = j$, следующей дугой может быть только дуга $\in U_0 \cup ... \cup U_j$, т.е. некоторая дуга, длина которой не превышает $g(j)$. Таким образом, требование монотонного невозрастания последовательности длин дуг записано через принадлежность дуг подмножествам. 

После того, как установлено соответствие с условием вентильной достижимости с возрастанием-убыванием доступа на пути, можно использовать алгоритм построения вспомогательного графа для этой задачи и искать кратчайший допустимый путь с помощью, например, алгоритма Дейкстры на вспомогательном графе. 

\subsection{Задача о допустимости пути только с числом дуг данного множества, кратным некоторому фиксированному числу}

Вновь рассмотрим ориентированный граф $G(X,U,f)$. Теперь граф не имеет ассоциированных с дугами характеристик, и есть два непересекающихся множества дуг --- стандартные $U_s$ и остаточные $U_o$. Будем называть путь на графе $G$ допустимым, если в нем содержится количество остаточных дуг, кратное фиксированному целому числу $p$ ($|p| > 1$). Как и прежде, для более наглядного применения условия будем использовать задачу о  кратчайшем (в смысле количества дуг) допустимом пути.

\begin{figure}
	\centering
	{\includegraphics[width=0.6\textwidth]{img/2.png}}
	{Пример графа с допустимым путем только с числом дуг из $U_o$, кратным $p$; черные стрелки означают дуги из $U_s$, синие --- из $U_o$.}
	\label{fig:pic_2}
\end{figure}

К примеру, для графа на рис.\ref{fig:pic_2} ясно, что кратчайший допустимый путь из 1-ой вершины в 4-ю при $p = 2$ нужно проложить как $1-2-3-2-4$, тогда в пути будет пара дуг из $U_o$.

Однако, свести это условие к каким-либо описанным в \cite{Mono} не удается. Причины этого рассмотрим более подробно.

Как было введено выше, условия, описанные в \cite{Mono}, разделяются на строгие и нестрогие. Однако, оба вида условий приводят к рекурсивному выбору дуг пути: на каждом шаге у нас есть путь до текущей вершины, удовлетворяющий условию на достижимость; для всех исходящих из текущей вершины дуг проверяется условие и выбирается следующая дуга пути. На следующем шаге для увеличенного на одну дугу пути условие на достижимость снова выполнено. Но в данной задаче условие задано таким образом, что на каждом шаге нет возможности определить, какую дугу необходимо добавить в путь следующей для гарантированного выполнения условия на достижимость: ни сохранение, ни смена кратности в середине пути не имеет значения, важна лишь кратность в конце пути. 

С другой стороны, можно обратить внимание на отсутствие модульности допустимого пути. Исходя из рекурсивного построения, модульность пути есть для задач, рассмотренных ранее. Но с условием текущей задачи проверки кратности очевидно, что если рассмотреть некоторый допустимый путь и убрать последнюю дугу при условии, что она принадлежит множеству $U_o$, мы получим путь до предыдущей вершины пути, который, однако, вовсе не является допустимым. Таким образом, получаем нарушение свойства модульности. 

Кроме того, если рассмотреть путь, не являющийся допустимым для условий, описанных в \cite{Mono}, всегда можно указать некоторый префикс, бывший допустимым путем, для которого было нарушено рекурсивное присоединение следующей дуги. В случае же проверки кратности, как выяснено ранее, рекурсивного правила выбора дуг нет, и нет возможности указать последний допустимый префикс.  

Эти особенности условия привели к необходимости введения новых терминов, а именно выделению глобальных условий на графах с нестандартной достижимостью. Глобальные условия, а также введённая выше задача, более строго рассматриваются в следующем разделе. Условия, описанные в \cite{Mono}, далее будем именовать локальными условиями на достижимость.

\section{Глобальные условия на графах с нестандартной достижимостью}

В этом разделе мы сформулируем важные особенности глобальных условий и более формально опишем последнюю задачу, побудившую выделить этот необычный тип условий. 

\newpage

\subsection{Основные положения глобальных условий на графах с нестандартной достижимостью}

Покажем отличие известного локального типа условий на достижимость от вводимых глобальных условий в сводной таблице.

\begin{table}[h]
	\centering
	\caption{Сравнение условий}
	\begin{tabular}{l | c | c }
		& Локальные условия & Глобальные условия \\
		\hline \hline
		Рекурсивный            & Да, по правилу строгого    & Нет, не применимо \\
		выбор пути			   & /нестрогого условия	    & \\
		\hline \hline
		Модульность            & Да, префикс допустимого    & Нет, не применимо \\
		пути			       & пути всегда допустим       & \\
		\hline \hline
		Проверка части         & Да, если путь не является  & Нет, любая часть, \\
		пути			       & допустимым, можно 			& меньшая целого пути, \\
		& выделить часть, которая    & не даст проверить \\
		& также не является      	& условие на достижимость \\
		& допустимым путем
	\end{tabular}
	\label{tabl:Compare}
\end{table}

Совокупность этих свойств глобальных условий говорит о некотором принципиальном отличии от локальных условий, позволяющем нам только проверить выполнение условия в конце пути, но не подбирать дуги пути в процессе прохода. 

На данном этапе мы пока закончим формальное описание глобальных условий за недостаточным количеством и разнообразием конкретных примеров условий. Далее под глобальными условиями будем понимать некоторые условия на достижимость, соответствующие перечисленным выше отличиям от локальных условий.   

Отсутствие модульности допустимого пути для глобального условия приводит к необходимости разделения вершин любого допустимого пути в соответствии с возможностью закончить путь в данной вершине. 

\newpage

\begin{definition}
	Пусть задан орграф с глобальным условием на достижимость и на нем определен некоторый допустимый путь $\mu$. Его вершины разделяются на два множества:
	\begin{itemize}
		\item достижимые вершины --- путь до которых удовлетворяет глобальному условию на достижимость, и которые могут стоять в конце допустимого пути,
		\item переходные вершины --- путь до них не удовлетворяет глобальному условию на достижимость, однако, они могут находиться в допустимом пути на любой позиции кроме конца.
	\end{itemize}
\end{definition}

Отметим, что вершина является достижимой или переходной только для конкретного пути, при этом для разных путей одна и та же вершина может быть и достижимой, и переходной. Таким образом, это не жёстко определённое свойство вершины, а, скорее, ее состояние в данном пути. 

Прежде чем мы вернемся к разбору задачи проверки кратности, приведем еще один (весьма вычурный!) пример глобальных условий на графах с нестандартной достижимостью.

Пусть задан взвешенный орграф и некоторое число $p$. Будем называть путь $\mu$ длины $n$ в этом графе допустимым, если веса дуг соответствуют коэффициентам уравнения одной переменной степени $n$, а число $p$ является его корнем. Ясно, что для такого условия вновь нет правила рекурсивного выбора, модульности пути и проверки части пути, что указывает на глобальность условия на достижимость. 

\newpage

\subsection{Задача о допустимости пути только с числом дуг данного множества, кратным некоторому фиксированному числу, как задача с глобальным условием на достижимость}

Пусть есть орграф $G(X,U,f)$, причём:
\begin{itemize}
	\item $U_* = U_s$ и $U^* = U_o$, числа $k, m$ фиксированы,
	\item $\psi_\mu(i) = \sum\limits_{j=0}^i | \mu(j) \cap U_o | \pmod p$ задает числовую характеристику пути, 
	\item и задано глобальное ограничение $\psi_\mu(-1) = 0$ на достижимость.
\end{itemize}

Несмотря на специфическое условие на достижимость, алгоритм построения вспомогательного графа мало отличается от аналогичных алгоритмов для графов с локальными условиями. Приведём его ниже.

Будем рассматривать граф $G'(X',U',f')$, именуемый вспомогательным, для которого: 
\begin{itemize}
	\item каждой вершине исходного графа $x \in X$ ставится в соответствие $p$ вершин $\{x^0, x^1, ... , x^{p-1} \}$ вспомогательного графа, образующие $X'$;
	\item для всех $u_i \in U_s$ отображение инцидентности задаётся как $f'(u_i) = (x^i, y^i)$;
	\item для $u_i \in U_o$:
	\begin{equation*}
	f'(u_i) = 
	\begin{cases}
	(x^i, y^{i+1}), &\text{$\forall i \in [0, p-2]$}\\
	(x^i, y^0), &\text{$i = p-1$}
	\end{cases}
	\end{equation*}
	\item дуги, упомянутые в двух предыдущих пунктах, образуют $U'$.
\end{itemize}

Сложность построения вспомогательного графа --- $\mathcal{O}(|X|p)$.

Стоит отметить, что индекс при вершине в рамках данной задачи говорит о количестве дуг из множества $U_o$ в текущем пути по модулю $p$. 

\begin{definition}
	Будем говорить, что множество $X'$ разбивается на уровни кратности по модулю $p$.
\end{definition}

Приведём также на рис.\ref{fig:pic_3} вспомогательный граф для рассмотренного ранее примера, помня, что $p = 2$. Для него наблюдаем два уровня кратности --- нулевой и первый.

\begin{figure}
	\centering
	{\includegraphics[width=0.9\textwidth]{img/3.png}}
	{Вспомогательный граф для примера из раздела 2.2; уровни кратности указаны слева, номера вершин --- снизу.}
	\label{fig:pic_3}
\end{figure}

Ясно, что во вспомогательном графе уже нет разбиения дуг на множества, все дуги --- обыкновенные, никаких условий на достижимость больше не ставится и все классические алгоритмы могут быть использованы обычным образом. Однако, чтобы удостовериться в последнем, необходимо связать пути на исходном и вспомогательном графах, что и рассматривается в следующей теореме. 

\begin{definition}
	Будем обозначать, что вершина $y$ достижима на некотором графе $G(X,U,f)$, следующим образом: $G \succ y$, при этом будем подразумевать, что она достижима в соответствии с условием на достижимость, если оно задано на графе $G$, и что она достижима в классическом смысле, если на графе $G$ нет условия на нестандартную достижимость.
	В случае недостижимости соответственно будем писать $G \prec y$.
\end{definition}

\begin{theorem}
	Любому пути $\mu'$ на вспомогательном графе $G'$ соответствует путь $\mu$ на графе $G$. При этом вершина $y$ достижима на графе $G$ с учетом условия кратности тогда и только тогда, когда $y^0$ достижима на графе $G'$. 
\end{theorem}

\begin{proof}
	
	\textit {Необходимость}
	
	Пусть сначала имеем путь $\mu$ длины $n$ на $G$. Доказательство будем проводить индукцией по $n$.
	
	1. \textit {База индукции}
	
	$n = 1$, то есть путь $\mu$ состоит из одной дуги $u$, $f(u) = (x, y)$. 
	
	Тогда:
	
	\begin{equation*}
	f'(u) = 
	\begin{cases}
	(x^0, y^0), &\text{$ u \in U_s$, $G' \succ y^0$, $G \succ y$}\\
	(x^0, y^1), &\text{$ u \in U_o$, $G' \prec y^0$, $G \prec y$}
	\end{cases}
	\end{equation*} 
	
	Как видим, есть соответствие, база индукции доказана.
	
	2. \textit {Предположение индукции}
	
	Пусть для $ n \leq s$ утверждения верны; докажем их для $ n = s + 1$.
	
	Имеем путь $\mu = \{u_{i_0}, ... , u_{i_s}\}$ такой, что $(p_1 \circ f')(u_{i_0}) = x^0$ и $(p_2 \circ f')(u_{i_s}) \cap \{y^0, ... , y^{p-1}\} \neq \emptyset$. Ясно, что для $\mu / \{u_{i_s}\}$ было выполнено предположение индукции. Обозначим $t = \psi_\mu(s)$.
	
	Сначала предположим, что $u_{i_s} \in U_s$. Тогда при добавлении $u_{i_s}$ в $\mu$ на $G$ кратность не меняется, а в $\mu'$ добавляется дуга $f'(x^t, y^t)$. То есть, в исходном графе достижимость вершины $y$ совпадает с достижимостью конечной вершины предыдущей дуги, а на вспомогательном графе не произошло перехода на другой уровень кратности, значит, в любом случае достижимость совпадает. 
	
	Теперь рассмотрим случай $u_{i_s} \in U_o$. При добавлении $u_{i_s}$ в $\mu$ кратность увеличилась на единицу, в $\mu'$ при этом добавилась дуга $f'(x^t, y^{(t+1) \pmod p})$. Здесь снова два случая:
	
	\begin{itemize}
		\item $t < p - 1$, тогда  $G \prec y$, $G' \prec y^0$
		\item $t = p - 1$, получаем $\psi_\mu(s+1) = p\pmod p = 0$, а на $G'$ стала достижимой $y^0$. Таким образом, $G' \succ y^0$, $G \succ y$.
	\end{itemize}
	
	И снова достижимость для исходного и вспомогательного графов совпадает. 
	
	Значит, предположение индукции верно для всех вариантов, и необходимость доказана.
	
	\textit {Достаточность}
	
	Если $y$ достижима с учётом кратности из $x$, то нa $G$ существует путь $\mu = \{u_0, ... , u_s\}$ такой, что $(p_1 \circ f)(u_0) = x, (p_2 \circ f)(u_s) = y$. Будем строить отображение $\alpha:U\to U'$ по следующим правилам:
	
	\begin{itemize}
		\item каждой дуге $u_i \in \mu$ ставится в соответствие некоторая дуга $\alpha(u_i) \in \mu'$ на $G'$;
		\item $(p_1 \circ f' \circ \alpha)(u_i) = (p_2 \circ f' \circ \alpha)(u_{i-1})$;
		\item дуга $\alpha(u_i)$ задана так, что: 
		\begin{equation*}
		(f' \circ \alpha)(u_0) =
		\begin{cases}
		(x^0, z^0), &\text{$ u_0 \in U_s$}\\
		(x^0, z^1), &\text{$ u_0 \in U_o$}
		\end{cases}
		\end{equation*} 
		
		\newpage
		
		\item если $f(u_i) = (a, b)$, то $(p_1 \circ f' \circ \alpha)(u_i) \in \{a^0, ... , a^{p-1}\}$ и $(p_2 \circ f' \circ \alpha)(u_i) \in \{b^0, ... , b^{p-1}\}$.
	\end{itemize}
	
	В соответствии с алгоритмом построения вспомогательного графа, отображение $\alpha$ можно построить для любого пути $\mu$; тогда на $G'$ получаем $\mu' = \{\alpha(u_0), ...  \alpha(u_s)\}$. При этом $\mu'$ соединяет $x^0$ и некоторое $y^{t \pmod p}$, где $t = \psi_\mu(s)$.
\end{proof}

Подчеркнём, что допустимым с учётом кратности путям на $G$ соответствуют только те пути на вспомогательном графе $G'$, которые оканчиваются на нулевом уровне кратности; все прочие вершины соответствуют вершинам на исходном графе в переходном состоянии и не подходят для завершения пути.  

\section{Заключение к разделу}

В данном разделе был рассмотрен ход рассуждений, приведший к выделению нового типа условий на графах с нестандартной достижимостью --- глобальных условий. Для них был выделен ряд заметных отличий, что позволяет с уверенностью утверждать, что их нельзя считать некоторым частным случаем локальных условий. С другой стороны, глобальные условия хорошо вписываются в общую теорию графов с нестандартной достижимостью, для них можно применять аналогичные теоремы и алгоритмы, что, в свою очередь, позволяет рассматривать новые задачи в разрезе уже существующей теории, а не выделять их в некоторую отдельную тему. 

Конкретно задача проверки кратности была выбрана для дальнейшего изучения благодаря простоте поставленного условия на достижимость. Можно предполагать, что использование этого глобального ограничения в задачах даст получить интересные и изящные результаты, вся совокупность которых будет представлена в следующем пункте данной работы. 

\chapter{Модельная задача с использованием примера глобального условия на достижимость}

\section{Нахождение предельного состояния случайного процесса: частный случай глобального условия на кратность}

В данном разделе предлагается рассматривать некоторую модельную задачу, использующую частный случай описанного ранее варианта глобального условия на достижимость, с целью получения более глубоких и практичных выводов. Ее строгая формулировка выглядит следующим образом:

\begin{itemize}
	\item задан сильно связный орграф $G(X,U,f)$;
	
	\item $U_* = \emptyset$ и $U^* = U_o = U$;
	
	\item $\psi_\mu(i) = \sum\limits_{j=0}^i | \mu(j)|\pmod p$ задает числовую характеристику пути; 
	
	\item в начальный момент времени по вершинам $G$ распределены частицы, которые перемещаются по его дугам на каждом такте;
	
	\item передвижение частиц на графе определяется матрицей переходов $P$, и таким образом на графе задан случайный процесс;
	
	\item определено множество вершин $V_s = \{v_{s_0}, v_{s_1}, ... , v_{s_q}\}$, из которых можно попасть в отдельный от графа сток $s$ с соответствующими вероятностями $\{p_{s_0}, p_{s_1}, ... , p_{s_q}\}$, если путь частицы до вершины из множества $V_s$ является допустимым в соответствии с глобальным ограничением на достижимость: $\psi_\mu(-1) = 0$.
\end{itemize}

Основной вопрос, который ставится для данной задачи, заключается в том, какое количество частиц покинет граф $G$ в предельном случае. Для начала, попробуем ответить на данный вопрос вне теории графов с нестандартной достижимостью. 

\subsection{Наивный подход}

Сначала приведем нестрогие размышления о задаче, которые далее запишем формально и докажем. 

Поскольку $G$ по условию является единой компонентой сильной связности, все вершины графа принадлежат циклам и частицы из любой вершины могут проходить по всем дугам. Для выполнения условия на достижимость для данной частицы нам нужно проложить путь от ее исходной вершины к вершине с возможностью выхода таким образом, чтобы длина этого пути была кратна $p$. Можно добиться этого, например, имея некоторый исходный путь (необязательно допустимый) длины $r$, который мы будем дополнять проходом по какому-нибудь контуру, стартующему из некоторой вершины этого пути. Если мы подберем контур такой, что его длина взаимно проста с $p$, то после ряда проходов по контуру мы сможем получить путь длины, сравнимой с нулем по модулю $p$. То есть, мы получим допустимый путь и для частицы появится возможность выйти из графа. Но требование взаимной простоты длины контура с параметром $p$, очевидно, выполняется не всегда. Значит, если мы выясним, при каких условиях возможно подобрать такие контуры, мы сможем ответить на основной вопрос задачи. Эти заключения приводят нас к следующим утверждениям:

\begin{lemma}
	Пусть $c_1, c_2, ... , c_q $ --- длины простых контуров графа $G$, который является единой компонентой сильной связности, причем $gcd(c_1, c_2, ... , c_q) = 1$. Тогда можно найти такой контур на графе $G$ (возможно, составной), что его длина $c = 1\pmod p$.
\end{lemma}

\begin{proof}
	Любой контур можно представить как линейную комбинацию простых контуров: 
	
	\begin{equation*}
	a_1c_1 + a_2c_2 + ... + a_qc_q = gcd(c_1, c_2, ... , c_q) = 1
	\end{equation*}
	
	Данное уравнение разрешимо в целых числах \cite{Hasse}, значит, существует набор $a_1, a_2, ... , a_q$ соответствующих целочисленных коэффициентов. В нашем случае коэффициенты должны быть неотрицательны, поскольку они обозначают количество проходов по простому контуру. Но поскольку нам требуется равенство по модулю $p$, все отрицательные коэффициенты можно заменить на положительные, соответствующие по модулю. Таким образом, мы получим линейную комбинацию с неотрицательными коэффициентами, а значит, всегда сможем задать такой контур, что условие на длину будет выполнено. 
\end{proof}

\begin{theorem}
	Пусть $c_1, c_2, ... , c_q $ --- длины простых контуров графа $G$, который является единой компонентой сильной связности, и $gcd(p, c_1, c_2, ... , c_q) = 1$. Тогда частицы из всех вершин в предельном случае окажутся в стоке.
\end{theorem}

\begin{proof}	
	Для того, чтобы все частицы покинули граф в пределе, необходимо показать, что произвольную вершину всегда можно соединить допустимым путем с вершиной из $V_s$. Как и описано, будем считать, что вершина $v$ соединяется с ней некоторым путем длины $r$, причем часть этого пути принадлежит некоторому контуру длины $b$. 
	
	\newpage 
	
	Мы всегда можем считать, что $gcd(p, b) = 1$, т. к. выполняется хотя бы одно из условий:
	
	\begin{itemize}
		\item среди простых контуров графа есть контур длины $c_i$ такой, что $gcd(p, c_i) = 1$ и тогда $b = c_i$, либо
		\item $gcd(c_1, c_2, ... , c_q) = 1$, и тогда в соответствии с доказанной леммой мы можем найти на графе контур $c$ длины, сравнимой с $1\pmod p$, и значит, $b = c$.
	\end{itemize}
	
	Следовательно, мы можем представить путь частицы в виде $r + bl$, где $l$ --- количество дополнительных проходов по контуру. Для того, чтобы этот путь был допустимым, необходимо и достаточно, чтобы выполнялось $r + bl = pm$. Перепишем в виде $r = b\hat{l} + pm$, где $\hat{l} = -l$. Отсюда получим $r = br\hat{l'} + prm'$, где $\hat{l'} = \hat{l} / r = -l / r, m' = m / r$. Это выражение представляет собой соотношение Безу \cite{Hasse}, домноженное на $r$. Уравнение $1 = b\hat{l'} + pm'$ разрешимо в целых числах только при взаимно простых $b, p$. Поскольку это условие выполнено, мы всегда получаем пару целочисленных коэффициентов, удовлетворяющих уравнению. Благодаря неоднозначности их определения, мы можем выбрать пару, где коэффициент при $b$ будет отрицательным, а при $p$ --- положительным, в соответствии со смыслом данных множителей, и значит, получить допустимый путь до стока из произвольной вершины.
\end{proof}

Эти результаты позволяют нам сделать вывод, что при взаимной простоте параметра $p$ и длин простых контуров $G$ все частицы покинут граф в пределе. 

В противном же случае, когда $gcd(c_1, c_2, ... , c_q) = d$, отличному от 1, и $gcd(p,d) > 1$, ясно, что мы cможем получить на графе $G$ только контуры длины, кратной $d$, т.к. 

\begin{equation*}
a_1c_1 + a_2c_2 + ... + a_qc_q = gcd(c_1, c_2, ... , c_q) = d,
\end{equation*}	и проход по таким контурам не будет менять кратности пути частиц до вершин из $V_s$. Тогда все вершины графа можно разделить на $p$ классов эквивалентности для каждой $v_{s_i}$ в соответствии с длиной любого пути из данной вершины до $v_{s_i}$ по модулю $p$.
Запишем это более формально.

\begin{definition}
	Будем называть $r$-ым классом эквивалентности графа $G(X, U, f)$ по вершине $v_{s_i}$ следующее подмножество вершин: $x_{i_r} = \{x \in X: (\mu_{from} = x) \wedge (\mu_{to} = v_{s_i}) \wedge (\psi_\mu(-1) = r \pmod p) \}$.
\end{definition}

Однако, для осуществления выхода из графа достаточно, чтобы вершина относилась к нулевому классу эквивалентности хотя бы для одной вершины из $V_s$. И на этом основании можно выделить два непересекающихся множества вершин следующим образом:

\begin{itemize}
	\item $X_{out} = \{x \in X: \exists i \in \overline{ [0; q] } : x \in x_{i_0} \} = \bigcup\limits_{i=0}^q x_{i_0}$, 
	\item $X_{in} = \{x \in X: \forall i \in \overline{ [0; q] } : x \notin x_{i_0} \} = \bigcap\limits_{i=0}^q (X \setminus x_{i_0})$.
\end{itemize}

Очевидно, для вершин из $X_{out}$ условие на достижимость бывает выполнено, а для вершин из $X_{in}$ --- нет. Это значит, что частицы также будут однозначно разделены на множества тех, которые покинут граф, и тех, которые будут бесконечно перемещаться по нему, в соответствии с тем, из какой вершины они начали движение. 

Полученные выше результаты позволяют нам теоретически рассчитывать количество частиц, оставшихся в графе $G$ или покинувших его, для любых ориентированных графов, представляющих собой единственную компоненту сильной связности. При этом для проведения такого расчета требуется только набор длин простых контуров исходного графа. Одним из вариантов получения этого набора является обращение к классическому алгоритму \cite{Cir}, который позволяет найти множество всех простых контуров за $\mathcal{O}((n + e)(c + 1))$, где $n$ --- количество вершин, $e$ --- количество дуг, $c$ --- количество простых контуров в графе $G$. Более того, для сокращения среднего времени работы алгоритма можно использовать распараллеленную версию \cite{Par}. Дополнительно необходимо только проверить наличие петель в графе, которое данный алгоритм не учитывает, и вычислить длины найденных контуров. 

Тогда если 

\begin{equation*}
a_1c_1 + a_2c_2 + ... + a_qc_q = gcd(c_1, c_2, ... , c_q) = 1,
\end{equation*}	все частицы покинут граф, а иначе дополнительно нужно разбить вершины на классы эквивалентности по вершинам из $V_s$. Выполнить это можно, например, с помощью BFS (breadth-first search, поиск в ширину) \cite{BFS}. После этого мы сможем получить множества $X_{in}$ и $X_{out}$, тем самым ответив на вопрос задачи. 

Сложность решения задачи этим методом --- $\mathcal{O}((n + e)^2(c + 1)|V_s|)$ в худшем случае, когда мы дополнительно использовали BFS.

\subsection{Вычислительный подход}

Приведенное решение имеет слабые стороны: оно достаточно (и не вполне предсказуемо) вычислительно сложное и не является универсальным. Попробуем разработать другой метод решения, опирающийся на теорию о нестандартной достижимости на графах. 

\newpage

В новом подходе к решению сформулированной задачи мы можем использовать результаты, полученные в прошлой главе, т.к. поставленное условие на достижимость является частным случаем разобранного выше глобального условия, когда множество стандартных дуг пусто. Значит, мы можем использовать приведенные ранее алгоритм построения вспомогательного графа и теорему о соответствии путей на исходном и вспомогательном графах.  

Пусть граф $G'$ --- вспомогательный граф для $G$, построенный в соответствии с алгоритмом. Теперь для того, чтобы учесть все условия задачи, нам необходимо выполнить дополнительные манипуляции:

\begin{itemize}
	\item всем дугам $f'(u_i)$ добавим вероятности перехода дуг $u_i$;
	\item множество вершин дополним новой вершиной $s$, являющейся стоком;
	\item вершине $s$ добавим петлю, т.к. все частицы, ушедшие в сток, могут только оставаться в стоке;
	\item обозначим возможность выхода в сток, проведя дуги из каждой вершины множества $\{v^0_{s_0}, v^0_{s_1}, ... , v^0_{s_q}\}$ в $s$, которые будем называть выходными;
	\item добавленным дугам сопоставим соответствующие вероятности перехода: $\{p_{s_0}, p_{s_1}, ... , p_{s_q}\}$;
	\item для всех дуг, исходящих из вершин множества $\{v^0_{s_0}, v^0_{s_1}, ... , v^0_{s_q}\}$, кроме выходных, пересчитаем вероятности перехода, 
	домножив их на величины $\{ 1 - p_{s_0}, 1 - p_{s_1}, ... , 1 - p_{s_q}\}$ для каждой такой вершины соответственно, поскольку сумма вероятностей переходов из любой вершины должна быть равна единице.
\end{itemize}	

Теперь мы получили вспомогательный граф $G'$, полностью описывающий поставленную задачу. Для ее решения, в свою очередь, нам достаточно рассмотреть соответствующую ему матрицу переходов и возвести ее в некоторую достаточно большую степень. Элементы итоговой матрицы будут соответствовать вероятностям перехода частиц между вершинами спустя продолжительное время. Тогда для вершин, у которых вероятность перехода в сток будет близка к единице, мы сможем утверждать, что практически все частицы, расположенные в них в начальный момент времени, покинут граф в пределе. 

Матрицу переходов $P'$ можно сразу получить по графу $G'$. Лучше всего ее записывать, упорядочив вершины вспомогательного графа по уровням кратности, и в конец ставить сток. Тогда, за исключением нижней строки и самого правого столбца, она имеет ярко выраженную блочную структуру: каждый блок отображает вероятности перехода частиц между вершинами двух уровней кратности. Ввиду специфики условия на достижимость, переход осуществляется на один и только на один уровень кратности вверх за такт времени и соответствующий переход по дуге. Поэтому в матрице блоки с ненулевыми элементами есть только на диагонали, расположенной сразу выше главной, и в левом нижнем углу. 

При этом в матрице $P'$ есть два вида блоков, кроме заполненных нулями. В случаях, когда условие на достижимость не выполняется, --- всюду ниже нулевого уровня кратности --- блоки соответствуют уже известной матрице $P$. На нулевом уровне кратности условие выполняется, и там блок соответствует несколько отличающейся матрице, которую мы обозначим как $P^*$. Эта матрица была получена из $P$ путем домножения вероятностей перехода для вершин из $V_s$ на соответствующие кооэффициенты, как описывалось в последнем пункте списка выше.

Помимо блоков, матрица включает в себя единицу в правом нижнем углу и вектор $S$ на нулевом уровне кратности в самом правом столбце, элементы которого обозначают вероятности выхода из данной вершины в сток.	Иначе говоря, он состоит из нулей и величин $\{p_{s_0}, p_{s_1}, ... , p_{s_q}\}$.

Сначала мы приведём $P'$ в компактном виде, где все элементы до разделительных линий представляют собой блоки размерности $n$, а остальные --- это нулевые вектора длины $n$, вертикальные и горизонтальные, вектор $S$ и единица. Ниже представим более детальную запись матрицы переходов вспомогательного графа $G'$:

\begin{displaymath}
\mathbf{P'} =
\left( \begin{array}{ccccc|c}
0 & P^* & 0 & 0 & ... & S \\
0 & 0 & P & 0 & ... & \overline {0^T} \\
0 & 0 & 0 & P & ... & \overline {0^T} \\
... & ... & ... & ... & ... & ... \\
P & 0 & 0 & 0 & ... & \overline {0^T} \\
\hline
\overline 0 &  \overline 0 &  \overline 0 &  \overline 0 & ... & 1 \\
\end{array} \right)
\end{displaymath}

\newpage 
\begin{table}[h]
	\centering
	\caption{Развернутая структура матрицы переходов $P'$,\newline частный случай}
	\begin{tabular}{l || c | c | c | c | c}
		& 0,1 0,2 ... 0,n & 1,1 1,2 ... 1,n & ... & p-1,1 p-1,2 ... p-1,n & s \\
		\hline \hline
		0,1 & $\overline 0$ & $P^*_{1,1}$ $P^*_{1,2}$ ... $P^*_{1,n}$ & ... & $\overline 0$ & $S_0$ \\
		... & ... & ... & ... & ... & ... \\
		0,i & $\overline 0$ & $P^*_{i,1}$ $P^*_{i,2}$ ... $P^*_{i,n}$ & ... & $\overline 0$ & $S_i$ \\
		... & ... & ... & ... & ... & ... \\
		0,n & $\overline 0$ & $P^*_{n,1}$ $P^*_{n,2}$ ... $P^*_{n,n}$ & ... & $\overline 0$ & $S_n$ \\
		\hline \hline
		1,1 & $\overline 0$ & $\overline 0$ & ... & $\overline 0$ & 0 \\
		... & ... & ... & ... & ... & ... \\
		1,i & $\overline 0$ & $\overline 0$ & ... & $\overline 0$ & 0 \\
		... & ... & ... & ... & ... & ... \\
		1,n & $\overline 0$ & $\overline 0$ & ... & $\overline 0$ & 0 \\
		\hline \hline
		... & ... & ... & ... & ... & ... \\
		... & ... & ... & ... & ... & ... \\
		\hline \hline
		p-1,1  & $P_{1,1}$ $P_{1,2}$ ... $P_{1,n}$ & $\overline 0$ & ... & $\overline 0$ & 0 \\
		... & ... & ... & ... & ... & ... \\
		p-1,i & $P_{i,1}$ $P_{i,2}$ ... $P_{i,n}$ & $\overline 0$ & ... & $\overline 0$ & 0 \\
		... & ... & ... & ... & ... & ... \\
		p-1,n & $P_{n,1}$ $P_{n,2}$ ... $P_{n,n}$ & $\overline 0$ & ... & $\overline 0$ & 0 \\
		\hline \hline
		s  & $\overline 0$ & $\overline 0$ & ... & $\overline 0$ & 1 \\
	\end{tabular}
	\label{tabl:P'}
\end{table}

Теперь, когда у нас есть матрица $P'$, для которой, как для матрицы переходов вспомогательного графа, условия на достижимость учтены по построению, мы можем возводить ее в достаточно большую степень для анализа ситуации в пределе. Возведение такой матрицы в большую степень можно реализовать разными способами, как достаточно простыми, так и более специфическими, использующими строгую структуру матрицы. К примеру, можно просто последовательно домножать результат на $P'$, можно перемножать результат между собой, удваивая таким образом степень на каждом шаге. Но кроме того, предлагается более специальный способ, принимающий во внимание квазиблочную структуру матрицы $P'$, который может быть полезен в случае больших графа $G$ или параметра $p$.	

Прежде всего, матрицу $P'$ нужно возвести в степень $p$ для приведения в блочно-диагональный вид, за исключением нижней строки и правого столбца. Возведение в степень матрицы диагонального вида сводится к возведению в некоторую степень всех диагональных элементов, а в нашем случае --- блоков на диагонали. Таким образом, для получения практически всех элементов матрицы в степени $2p$ нам достаточно сначала возвести ее в степень $p$ произвольным способом, а потом получить квадраты матриц размерности $n$, расположенных на диагонали. 

Оcталось рассчитать значения в правом столбце. В соответствии с обычными правилами умножения матриц, каждый элемент этого столбца будет представлять собой скалярное произведение некоторых строки и столбца матрицы $(P')^p$. Но с учетом того, что ненулевые блоки расположены в матрице только на диагонали, часть правого столбца для $i$-ого уровня кратности, $col_i$, можно получить по формуле: $(col_i)^{2p} = B_i(col_i)^{p} + (col_i)^{p}$, где $B_i$ --- блочная матрица на $i$-ом уровне кратности $(P')^p$. Теперь, получив формулы для всех элементов матрицы, можно последовательно возводить результаты в квадрат до некоторой достаточно большой степени.

После того, как мы возвели матрицу переходов в степень, ответить на вопрос задачи не составляет труда. Все частицы из данной вершины в пределе покинут граф, если в соответствующей строке самого правого столбца матрицы на нулевом уровне кратности получена вероятность, близкая к единице; иначе эти частицы продолжат перемещаться по графу бесконечно. 

В завершении описания данного подхода можно дополнительно усилить результат. Посчитав результирующую матрицу в пределе, мы, в действительности, получили описание всей системы на этот удаленный момент времени. Это может быть полезным, но в контексте текущей задачи, на самом деле, достаточно получить $(P')^p$, а после этого удваивать степени только для $B_0$ и $(col_0)$, тем самым дополнительно сократив количество операций. В итоге мы также получим значения элементов правого столбца на нулевом уровне кратности и решим задачу. 

С учётом предложенного способа возведения матрицы в степень, сложность данного метода составит $\mathcal{O}((np)^{3 \log_2 p} + n^{3 \log_2 w})$, где $w$ --- желаемая степень матрицы, или такт времени, который мы рассматриваем как предел.

\subsection{Теоретический подход}

Однако, когда мы уже построили вспомогательный граф $G'$, получение его матрицы перехода и возведение ее в степень --- не самое оптимальное решение для получения ответа. Поскольку вспомогательный граф по построению учитывает все наложенные условия, никаких внешних ограничений мы для него уже не добавляем. То есть, $G'$ --- обычный граф, и мы можем использовать для работы с ним классическую теорию графов. 

Рассмотрим $G'$, исключая сток и выходные дуги, и разделим оставшийся подграф $G''$ на компоненты сильной связности. Можно использовать классический алгоритм поиска сильно-связных компонент \cite{Tar} или подход, поддерживающий распараллеливание \cite{Par2}.
Поскольку исходный граф $G$ является сильно связным, $G''$ обязательно будет представлять из себя одну или несколько изолированных компонент сильной связности. %Док-во?   

Если мы получим единственную компоненту, то все вершины с нулевого уровня кратности связаны контурами, включая вершины с возможностью выхода, и тогда в пределе все частицы смогут уйти в сток. 

Иначе мы получим несколько компонент, и для анализа предельного случая нужно строить классы эквивалентности для вершин с возможностью выхода. В контексте данного подхода определим их как $x_{i_r} = \{x \in X: x^r \succ v^0_{s_i} \}$. Отсюда можем получить множества $X_{in}$ и $X_{out}$. Они будут определяться так же, как и в первом решении: $X_{out} = \bigcup\limits_{i=0}^q x_{i_0}, X_{in} = \bigcap\limits_{i=0}^q (X \setminus x_{i_0})$, и мы получили ответ задачи. 

Несмотря на разные определения классов эквивалентности в двух подходах, ясно, что логика их получения идентична, только в первом способе кратность длины пути мы учитывали вручную, а теперь она учтена автоматически по построению. 

Для теоретического подхода сложность по времени составит  $\mathcal{O}(np(n + e))$.

%---------------------------------------------------------------------------------

\section{Нахождение предельного состояния случайного процесса: общий случай глобального условия на кратность}

После того, как мы рассмотрели применение частного случая предложенного глобального условия на достижимость, можно усилить наши результаты, вернувшись к исходному варианту ограничения. В этом разделе мы сформулируем более общую задачу и распространим на нее приведенные выше методы. Более строгая постановка задачи звучит так: 	

\begin{itemize}
	\item как и прежде, задан орграф $G(X,U,f)$;
	\item но добавлено разделение дуг на множества: $U_* = U_s$ и $U^* = U_o$, числа $k, m$ фиксированы;
	\item $\psi_\mu(i) = \sum\limits_{j=0}^i | \mu(j) \cap U_o | \pmod p$ --- числовая характеристика пути учитывает дуги только из $U_o$; 
	\item перемещение частиц по графу в соответствии с матрицей $P$ и их выход в сток $s$ реализованы так же, как и в частном случае.
\end{itemize}

Вопрос задачи также остается прежним: нужно определить, какое количество частиц покинет граф $G$ в пределе. Пройдем по всем трем методам решения и применим их для нынешней формулировки. 

\subsection{Наивный подход}

Все размышления, приведенные выше в этом способе, будут иметь силу и для общей задачи при одном только исправлении. Всюду, где ранее мы упоминали обычную длину контуров на $G$, нужно использовать длину контуров, из которых были удалены нейтральные дуги множества $U_s$. Вычисленные значения можно дополнительно взять по модулю $p$ для большего удобства. Таким образом мы, по определению, для каждого контура $\mu$ получим числовую характеристику $\psi_\mu(-1)$. 

Принимая во внимание эти детали, приведем формулировки леммы и теоремы для общего случая. Доказательства этих утверждений можно провести также, как и в частном случае задачи. 

\begin{lemma}
	Пусть $c_1, c_2, ... , c_q$ --- числовые характеристики простых контуров сильно связного графа $G$, причем $gcd(c_1, c_2, ... , c_q) = 1$. Тогда можно найти такой контур на графе $G$ (возможно, составной), что его числовая характеристика $c = 1$.
\end{lemma}

\begin{theorem}
	Пусть $c_1, c_2, ... , c_q $ --- числовые характеристики простых контуров графа $G$, который является единой компонентой сильной связности, и $gcd(p, c_1, c_2, ... , c_q) = 1$. Тогда частицы из всех вершин в пределе окажутся в стоке.
\end{theorem}

Мы получаем аналогичный вывод: при взаимной простоте параметра $p$ и  числовых характеристик простых контуров $G$ все частицы покинут граф в пределе. Иначе, как и в частном случае, идентично определяется разбиение вершин на классы эквивалентности по вершинам с возможностью выхода и на пару множеств $X_{in}$ и $X_{out}$. Сложность решения такая же, как и в частном случае. 

\subsection{Вычислительный подход}

Мы, как и ранее, сгенерируем вспомогательный граф $G'$, рассмотрим его матрицу переходов и возведём ее в некоторую достаточно большую степень. Действительно, подход к решению целиком идентичен тому, что было рассмотрено в частном случае. Различия будут заключаться в виде графа $G'$ и, соответственно, матрице переходов. Изучим этот вопрос подробнее. 

Вспомогательный граф, полученный только путём применения алгоритма из первой главы, в общем случае будет отличаться наличием дуг без перехода на следующий уровень кратности. Такие дуги на $G'$ соответствуют дугам из множества $U_s$ на исходном графе, которые не учитываются условием на достижимость. Наложение дополнительных условий задачи, таких как наличие стока, вершин с вероятностью выхода, пересчёт вероятностей --- все эти этапы пройдут аналогично частному случаю и не изменят хода решения.

Перейдем к рассмотрению матрицы переходов $P'$. Записывать мы её будем, как и прежде, упорядочив $G'$ по уровням кратности, и в конец ставить сток. Нижняя строка и правый столбец те же, что и в частном случае. Блочная структура также сохранена, но теперь ещё и диагональ заполнена ненулевыми блоками. Это явным образом соответствует условию на достижимость: у нас есть дуги множества $U_s$, переход по которым сохраняет уровень кратности. При этом дуги из множества $U_o$ также присутствуют в графе, осуществляя возможность перехода на следующий уровень кратности. Благодаря этим дугам блоки, которые были ненулевыми в частном случае, остались заполнены. 

Иными словами, блоки на главной диагонали соответствуют переходам по дугам из $U_s$, а блоки над главной диагональю (и в левом нижнем углу) отвечают переходам по дугам из множества $U_o$. В частном случае это также было верно, но тогда множество $U_s$ было пусто, в результате главная блочная диагональ была нулевой. Более того, поэлементное OR, применённое к паре блоков на одном уровне кратности матрицы $P'$, в результате даст $P^*$ на нулевом уровне кратности и $P$ на всех других. И снова это выполнялось и для частного случая, только один из операндов тогда был нулевым блоком. 

Таким образом, в матрице $P'$ четыре ненулевых вида блоков. Будем обозначать 
их как $Ps^*$, $Po^*$, когда условие на достижимость верно, и $Ps$, $Po$ иначе, в соответствии с тем, какое множество дуг используется для данного блока. Теперь мы можем записать $P'$ как в компактном, так и в развернутом виде:

\begin{displaymath}
\mathbf{P'} =
\left( \begin{array}{ccccc|c}
Ps^* & Po^* & 0 & 0 & ... & S \\
0 & P_s & Po & 0 & ... & \overline {0^T} \\
0 & 0 & P_s & Po & ... & \overline {0^T} \\
... & ... & ... & ... & ... & ... \\
Po & 0 & 0 & 0 & ... & \overline {0^T} \\
\hline
\overline 0 &  \overline 0 &  \overline 0 &  \overline 0 & ... & 1 \\
\end{array} \right)
\end{displaymath}

\newpage 
\begin{table}[h]
	\centering
	\caption{Развернутая структура матрицы переходов $P'$,\newline
		общий случай}
	\begin{tabular}{l || c | c | c | c | c}
		& 0,1 0,2 ... 0,n & 1,1 1,2 ... 1,n & ... & p-1,1 p-1,2 ... p-1,n & s \\
		\hline \hline
		0,1 & $Ps^*_{1,1}$ $Ps^*_{1,2}$ ... $Ps^*_{1,n}$ & $Po^*_{1,1}$ $Po^*_{1,2}$ ... $Po^*_{1,n}$ & ... & $\overline 0$ & $S_0$ \\
		... & ... & ... & ... & ... & ... \\
		0,i & $Ps^*_{i,1}$ $Ps^*_{i,2}$ ... $Ps^*_{i,n}$ & $Po^*_{i,1}$ $Po^*_{i,2}$ ... $Po^*_{i,n}$ & ... & $\overline 0$ & $S_i$ \\
		... & ... & ... & ... & ... & ... \\
		0,n & $Ps^*_{n,1}$ $Ps^*_{n,2}$ ... $Ps^*_{n,n}$ & $Po^*_{n,1}$ $Po^*_{n,2}$ ... $Po^*_{n,n}$ & ... & $\overline 0$ & $S_n$ \\
		\hline \hline
		1,1 & $\overline 0$ & $Ps_{1,1}$ $Ps_{1,2}$ ... $Ps_{1,n}$ & ... & $\overline 0$ & 0 \\
		... & ... & ... & ... & ... & ... \\
		1,i & $\overline 0$ & $Ps_{i,1}$ $Ps_{i,2}$ ... $Ps_{i,n}$ & ... & $\overline 0$ & 0 \\
		... & ... & ... & ... & ... & ... \\
		1,n & $\overline 0$ & $Ps_{n,1}$ $Ps_{n,2}$ ... $Ps_{n,n}$ & ... & $\overline 0$ & 0 \\
		\hline \hline
		... & ... & ... & ... & ... & ... \\
		... & ... & ... & ... & ... & ... \\
		\hline \hline
		p-1,1  & $Po_{1,1}$ $Po_{1,2}$ ... $Po_{1,n}$ & $\overline 0$ & ... & $Ps_{1,1}$ $Ps_{1,2}$ ... $Ps_{1,n}$ & 0 \\
		... & ... & ... & ... & ... & ... \\
		p-1,i & $Po_{i,1}$ $Po_{i,2}$ ... $Po_{i,n}$ & $\overline 0$ & ... & $Ps_{i,1}$ $Ps_{i,2}$ ... $Ps_{i,n}$ & 0 \\
		... & ... & ... & ... & ... & ... \\
		p-1,n & $Po_{n,1}$ $Po_{n,2}$ ... $Po_{n,n}$ & $\overline 0$ & ... & $Ps_{n,1}$ $Ps_{n,2}$ ... $Ps_{n,n}$ & 0 \\
		\hline \hline
		s  & $\overline 0$ & $\overline 0$ & ... & $\overline 0$ & 1 \\
	\end{tabular}
	\label{tabl:comP'}
\end{table}

Осталось только возвести матрицу $P'$ в степень и проанализировать самый правый столбец на нулевом уровне кратности. Структура матрицы уже не такая удобная, как в частном случае, и мы не будем рассматривать специальные методы для ускоренного умножения. Организуем возведение в степень удваиванием степени, что уже достаточно быстро. В итоге, мы получим временную сложность $\mathcal{O}((np)^{3 \log_2 w})$, где $w$, как и прежде, предельная степень.

\subsection{Теоретический подход}

Этот способ решения одинаков для частного и общего случая, что является неоспоримым плюсом. Так происходит потому, что все изыскания мы проводили над вспомогательным графом. Но когда мы его построили, все условия функционирования системы уже учтены в процессе построения, и можно сосредоточиться исключительно на вопросе задачи, общем для обоих случаев. 

Иными словами, получение классов эквивалентности и множеств $X_{in}$ и $X_{out}$ осуществляется аналогично частному случаю, поскольку все различия в постановке задач были учтены при генерации $G'$ и не играют роли на следующих этапах решения. Соответственно, сложность подхода такая же, как и для частного случая. 

\section{Заключение к разделу}

В этом разделе мы рассмотрели модельную задачу, для которой использовалось глобальное условие на достижимость с проверкой кратности. Было предложено три подхода, которые сначала рассматривались для более частного случая задачи, а потом были расширены на общий случай. 

Первый подход, не использовавший методы и теорию графов с нестандартной достижимостью, безусловно, решил поставленную задачу, но потребовал специальных теоретических изысканий, которые, судя по всему, будет нелегко применить при несколько иной формулировке глобального условия. 

Метод, основанный на работе с матрицей переходов, имеет большую вычислительную сложность, но при этом он действительно мощный и универсальный. Если нужно, мы можем получить состояние всей системы в пределе, и он применим даже несколько за границами сформулированной нами задачи. В отличие от двух других методов, им можно пользоваться и в случае несвязных графов. 

Теоретический подход, максимально задействующий как классическую теорию графов, так и теорию графов с нестандартной достижимостью, позволяет решить задачу за меньшее время и допускает изменение условия проверки пути. Он использует вспомогательный граф, который по построению учитывает допустимость пути как в частном, так и в общем случае, и таким образом предоставляет идентичное для обеих формулировок решение.   

\chapter{Заключение}

Данная работа была посвящена исследованию глобальных условий на достижимость. В начале мы предложили условие, которое имеет некоторые занимательные особенности, затем формально описали их, и далее использовали предложенное условие в задаче.

В перспективе можно рассчитывать на обнаружение других примеров глобальных условий. Большее количество рассматриваемых экземпляров, возможно, позволит расширить предложенные теоретические основы по данной теме. 

Применение глобальных условий в задачах, однако, весьма напоминает использование локальных условий на достижимость. В некотором смысле, вероятно, это затрудняет вычленение глобальных условий: для решения задач с ними вполне подходят уже известные методы, а их специфические свойства становятся явными только при попытке формально их описать.  

\newpage 

% Подробно по оформлению библиографии:
% см. документацию к пакету biblatex-gost
% http://ctan.mirrorcatalogs.com/macros/latex/exptl/biblatex-contrib/biblatex-gost/doc/biblatex-gost.pdf
% и огромное количество примеров там же:
% http://mirror.macomnet.net/pub/CTAN/macros/latex/contrib/biblatex-contrib/biblatex-gost/doc/biblatex-gost-examples.pdf